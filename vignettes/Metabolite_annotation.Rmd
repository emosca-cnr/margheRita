---
title: "Metabolite_annotation"
author: "zahrasadat alavikakhki"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Metabolite_annotation}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r , eval=FALSE}
library(margheRita)
```

##The workflow of metabolic identification 

a) Retention time similarity. If RT of precursor in Library is close to RT in Sample
b) mass similarity by calculating PPM error
c) ion mass similarity by calculating PPM error for intensive peaks for MS/MS spectroscopy 

#retention time similarity
If the retention time for the metabolite i in reference library be t_i and the retention time for the compound j in the sample be t_j then the retention time error between a sample feature j and metabolite i in the reference library is the absolute difference between the two retention times

```{r, eval=FALSE}
RT = check_RT(feature_data =  , reference = , rt_window= , rt_err_thr= )
```

#mass similarity by calculating PPM error
The similarity between two masses is calculated by the ppm error (parts per million) which is determining mass tolerance. The PPM error is calculated as the relative error between the mass of a feature j and mass of the reference in the library i.

according to our study goal, we delete those with bad PPM error and assign a feature to the one with good PPM error in mass status column. 
Ppm error < a – super
Ppm error < b – acceptable, may happen when ions are of low intensities
Ppm error < c – may happen when machine suffer a bit.
Ppm error > d – not good


```{r, eval=FALSE}
mass = check_mass(feature_data =  , reference = , unaccept_flag= d, accept_flag= a, suffer_flag= b)
```


#Merging ideal candidate in term of Retention Time and PPM error

```{r, eval=FALSE}
RT_mass = check_RT_mass (RT , mass, reference=  )
```

#establishing new library & sample data by calculating relative intensity
convert intensity to relative intensity and deleting the negligible relative intensity, both in library and sample spectra.
relative intensity is calculated by dividing ion intensity to the maximum ion intensity in spectra.

```{r, eval=FALSE}
RI_lib = RI_lib_data ( reference =  , RT_mass, acceptable_RI = r)
```


```{r, eval=FALSE}
RI_sample = RI_sample_data (feature_spectra= , acceptable_RI = r )
```


#ions mass similarity by calculating PPM error for intensive peaks for MS/MS spectroscopy 

Those peaks candidate that distinguishing as metabolite i among compound j in the sample have two main criteria at the same time: strong relative intensity and good PPM error. 
the most important peaks are the most intense ones. So, we are calculating the PPM error pick by pick for the most intense ones the number of the peaks that we are considering depends on the accuracy that we want. 
```{r, eval=FALSE}
intense_peak = check_intense_peak(RT_mass, RI_lib , RI_sample, n_peaks= , acceptable_PPM_err = )
```


